{"body": "<div class=\"section\" id=\"run-daemons\">\n<h1>Run Daemons<a class=\"headerlink\" href=\"#run-daemons\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"before-you-begin\">\n<h2>Before you begin<a class=\"headerlink\" href=\"#before-you-begin\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Although it doesn&#8217;t need to be running on the same machine, you need to have a\nKegbot Server set up for reporting drinks.  After all, Kegbot Core needs\nsomething to talk to.  Refer to <a class=\"reference internal\" href=\"../../server-guide/#server-guide\"><em>Kegbot Server Guide</em></a> if necessary.</p>\n</div>\n<div class=\"section\" id=\"common-options\">\n<h2>Common Options<a class=\"headerlink\" href=\"#common-options\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Each Kegbot program supports some common flags on the command line, in\nparticular:</p>\n<dl class=\"docutils\">\n<dt><strong>&#8211;help</strong></dt>\n<dd>Shows complete help for the program, including common options.</dd>\n<dt><strong>&#8211;helpshort</strong></dt>\n<dd>Shows a subset of <em>&#8211;help</em>, just local options.</dd>\n<dt><strong>&#8211;[no]daemon</strong></dt>\n<dd>Run (or don&#8217;t run) as a background daemon. Default <tt class=\"docutils literal\"><span class=\"pre\">false</span></tt>.</dd>\n<dt><strong>&#8211;[no]verbose</strong></dt>\n<dd>Log lots of debugging information.</dd>\n</dl>\n<p>There are many more flags; for more information, see the output of <em>&#8211;help</em>.</p>\n</div>\n<div class=\"section\" id=\"run-kegbot-core\">\n<h2>Run Kegbot Core<a class=\"headerlink\" href=\"#run-kegbot-core\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>There are two important parameters that should be provided to Kegbot Core:</p>\n<dl class=\"docutils\">\n<dt><strong>&#8211;api_url</strong></dt>\n<dd>The URL of your Kegbot Server, for example,\n<tt class=\"docutils literal\"><span class=\"pre\">--api_url=http://localhost:8000/api/</span></tt></dd>\n<dt><strong>&#8211;api_key</strong></dt>\n<dd>The API key for authenticating to your Kegbot Server.</dd>\n</dl>\n<p>Armed with the correct values for these, give it a try.  Open up a new terminal\nand run the program:</p>\n<div class=\"highlight-python\"><pre>(pycore) $ kegbot_core.py --api_url=http://localhost:8000/api/ --api_key=100000012345678\n2012-06-21 23:06:34,705 INFO     (main) Kegbot is starting up.\n2012-06-21 23:06:34,710 INFO     (main) Querying backend liveness.\n2012-06-21 23:06:34,938 INFO     (main) Backend appears to be alive.\n2012-06-21 23:06:34,939 INFO     (main) Found 2 taps, adding to tap manager.\n2012-06-21 23:06:34,939 INFO     (tap-manager) Registering new tap: kegboard.flow0\n2012-06-21 23:06:34,939 INFO     (tap-manager) Registering new tap: kegboard.flow1\n2012-06-21 23:06:34,939 INFO     (main) Starting all service threads.\n2012-06-21 23:06:34,939 INFO     (main) starting thread \"service-thread\"\n2012-06-21 23:06:34,939 INFO     (main) starting thread \"net-thread\"\n2012-06-21 23:06:34,940 INFO     (main) starting thread \"watchdog-thread\"\n2012-06-21 23:06:34,940 INFO     (net-thread) network thread started\n2012-06-21 23:06:34,940 INFO     (kegnet) Starting server on ('localhost', 9805)\n2012-06-21 23:06:34,940 INFO     (main) starting thread \"eventhub-thread\"\n2012-06-21 23:06:34,941 INFO     (main) starting thread \"heartbeat-thread\"\n2012-06-21 23:06:34,941 INFO     (main) All threads started.</pre>\n</div>\n<p>Awesome!  Your core is now running.  It&#8217;s now time to connect the Kegboard Daemon to it.</p>\n</div>\n<div class=\"section\" id=\"run-kegboard-daemon\">\n<h2>Run Kegboard Daemon<a class=\"headerlink\" href=\"#run-kegboard-daemon\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Connect your Kegboard to your machine.  (Need to build a Kegboard? See\n<a class=\"reference internal\" href=\"../../kegboard/#kegboard-guide\"><em>Kegboard Guide</em></a>).</p>\n<p>By default, this daemon looks for a USB device at <tt class=\"docutils literal\"><span class=\"pre\">/dev/ttyUSB0</span></tt>, but on a Mac\nor with multiple devices attached you may need to use something different.\nSpecify it with <strong>&#8211;kegboard_device</strong>.</p>\n<p>Open a second terminal and run the daemon in the foreground:</p>\n<div class=\"highlight-python\"><pre>(pycore) $ kegboard_daemon.py --kegboard_device=/dev/cu.usbmodemfd131\n2012-06-21 23:10:37,881 INFO     (main) Starting all service threads.\n2012-06-21 23:10:37,881 INFO     (main) starting thread \"kegnet\"\n2012-06-21 23:10:37,881 INFO     (kegnet) Connecting to localhost:9805\n2012-06-21 23:10:37,881 INFO     (main) starting thread \"kegboard-manager\"\n2012-06-21 23:10:37,881 INFO     (kegboard-manager) Starting main loop.\n2012-06-21 23:10:37,882 INFO     (main) starting thread \"device-io\"\n2012-06-21 23:10:37,882 INFO     (device-io) Starting reader loop...\n2012-06-21 23:10:37,882 INFO     (main) All threads started.\n2012-06-21 23:10:37,883 INFO     (main) Running generic main loop (going to sleep).\n2012-06-21 23:10:37,883 INFO     (kegnet) Connected!\n2012-06-21 23:10:40,321 INFO     (device-io) Found a Kegboard! Firmware version 10\n2012-06-21 23:10:40,347 INFO     (kegboard-manager) RX: &lt;HelloMessage: firmware_version=10&gt;</pre>\n</div>\n<p>You can see the program has connected to port 9805, the Kegbot Core, on the\nlocal machine, and has found a Kegboard.  Back in the Core terminal, you should\nsee a new message logging the connection:</p>\n<div class=\"highlight-python\"><pre>2012-06-21 23:10:37,884 INFO     (kegnet) Remote host connected: 127.0.0.1:65447</pre>\n</div>\n<p>If you have a temperature sensor connected, you will see those messages in logs,\ntoo.  Finally, and most importantly, activity on the flow meter inputs will now\nbe reported to the Kegbot Core and start the flow processing logic.</p>\n</div>\n<div class=\"section\" id=\"run-extras\">\n<h2>Run Extras<a class=\"headerlink\" href=\"#run-extras\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>There are a few extra accessory programs shipping with Pycore.</p>\n<dl class=\"docutils\">\n<dt><strong>kegboard-tester.py</strong></dt>\n<dd>A standalone program that tests toggles the relays on a Kegboard in a loop.\nDo not use unless you are testing a board.</dd>\n<dt><strong>kegboard_monitor.py</strong></dt>\n<dd>A standalone program which just prints Kegboard messages without any further\nreporting.</dd>\n<dt><strong>lcd_daemon.py</strong></dt>\n<dd>A program for managing a serial character LCD, displaying pour information\nduring a pour.</dd>\n<dt><strong>rfid_daemon.py</strong></dt>\n<dd>An authentication program, which reads RFID tags from a Phidgets RFID reader\nand reports them to Kegbot Core as authentication tokens.</dd>\n<dt><strong>sound_server.py</strong></dt>\n<dd>A program which listens for active flows and plays sounds at certain events.</dd>\n<dt><strong>test_flow.py</strong></dt>\n<dd>A test program which simulates a pour by sending a sequence of events to the\ncore.  Use it if you&#8217;d like to test the rest of your system without needing a\nKegboard or flow meter.</dd>\n</dl>\n<p>Consult the <em>&#8211;help</em> documentation for information about these programs.</p>\n</div>\n<div class=\"section\" id=\"run-in-background\">\n<h2>Run in background<a class=\"headerlink\" href=\"#run-in-background\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>So far we&#8217;ve covered running the Pycore applications in the foreground.  But\nonce you&#8217;ve got your system all setup, you&#8217;ll probably want your Linux box to\nrun all the daemons automatically.</p>\n<p>Kegbot isn&#8217;t much different than other Linux daemons in this regard, so you have\na number of options.</p>\n<div class=\"section\" id=\"using-kegbot-master\">\n<h3>Using kegbot_master<a class=\"headerlink\" href=\"#using-kegbot-master\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Kegbot ships with a simple daemon launcher/monitor program,\n<strong>kegbot_master.py</strong>.</p>\n<p>Most of the documentation for <em>kegbot_master.py</em> can be found in its example\nconfiguration file:</p>\n<div class=\"highlight-python\"><pre>### kegbot_master config file\n\n# This file lists applications to run as daemons.  They can be collectively\n# started and stopped with kegbot_master.py.\n#\n# Each section defines an application to run; the name of the section is\n# typically the name of the program, but does not have to be (see example use of\n# _program_name below).\n#\n# Each value in the section gives a command line flag and value to use.  Values\n# that begin with an underscore are special values that are only used by\n# kegbot_master.  Current special values:\n#   _pidfile_dir: the value of the kegbot_master flag --pidfile_dir\n#   _logfile_dir: the value of the kegbot_master flag --logfile_dir\n#   _enabled: indicates whether the app defined in this section should be\n#             started\n#\n# Each section also has several default flags and values, which can be\n# overridden on an app-by-app basis. Those flags are:\n#   pidfile: the default value is `&lt;pidfile dir&gt;/&lt;app_name&gt;.pid`\n#   daemon: the default value is True (and should not be changed)\n#   log_to_stdout: the default value is False (and should not be changed)\n#   log_to_file: the default value is True\n#   logfile: the default value is `&lt;logfile dir&gt;/&lt;app_name&gt;.log`\n#\n# You can substitute values in your flag definitions. For example:\n#   [myapp]\n#   _program_name = whatever.py\n#   logfile = /tmp/%(__name__)s.log\n#\n# In this example, the special value `__name__` is replaced with the name of the\n# application section (myapp). The final command that executes would be:\n#   whatever.py --logfile=/tmp/myapp.log [.. other defaults ..]\n#\n# You can run `kegbot_master.py configtest` to see what commands your config\n# file would execute if `start` was called.\n\n\n### Apps\n\n[kegbot_core]\n_enabled = True\napi_url = 'http://example.com/api'\napi_key = 'API_KEY'\n\n[kegboard_daemon]\n_enabled = True\nkegboard_device = /dev/ttyUSB0\n\n[lcd_daemon]\n_enabled = False\nlcd_device_path = /dev/ttyUSB1\n\n[sound_server]\n_enabled = True\n\n[second_kegboard]\n# Example showing a second instance of kegboard_daemon.\n_enabled = False\n\n# Normally, the section name is used to automatically generate the value of\n# _program_name. However, we want to run kegboard_daemon twice, and we can't\n# have two sections named '[kegboard_daemon]'.\n#\n# To get around this, we name this section whatever we want ([second_kegboard]),\n# and manually specify the _program_name variable.\n_program_name = kegboard_daemon.py\n\n# Other kegboard_daemon flags.\nkegboard_name = second_tap\nkegboard_device = /dev/ttyUSB2\n\n[fb_publisher]\n# Facebook publisher.\n_enabled = False\n\n[kegbot_twitter]\n# Twitter publisher.\n_enabled = False</pre>\n</div>\n</div>\n<div class=\"section\" id=\"using-supervisor\">\n<h3>Using Supervisor<a class=\"headerlink\" href=\"#using-supervisor\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>An excellent and widely used third-party process monitor is\n<a href=\"#id1\"><span class=\"problematic\" id=\"id2\">:ref:`Supervisor http://supervisord.org/`_</span></a>. Please see its detailed\ndocumentation for instructions.</p>\n</div>\n</div>\n</div>\n", "display_toc": true, "title": "Run Daemons", "sourcename": "pycore-guide/run-daemons.txt", "customsidebar": null, "current_page_name": "pycore-guide/run-daemons", "next": {"link": "../../developer/", "title": "Developer Notes"}, "rellinks": [["genindex", "General Index", "I", "index"], ["developer/index", "Developer Notes", "N", "next"], ["pycore-guide/install-pycore", "Install Pycore", "P", "previous"]], "meta": {}, "parents": [{"link": "../", "title": "Pycore Guide"}], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Run Daemons</a><ul>\n<li><a class=\"reference internal\" href=\"#before-you-begin\">Before you begin</a></li>\n<li><a class=\"reference internal\" href=\"#common-options\">Common Options</a></li>\n<li><a class=\"reference internal\" href=\"#run-kegbot-core\">Run Kegbot Core</a></li>\n<li><a class=\"reference internal\" href=\"#run-kegboard-daemon\">Run Kegboard Daemon</a></li>\n<li><a class=\"reference internal\" href=\"#run-extras\">Run Extras</a></li>\n<li><a class=\"reference internal\" href=\"#run-in-background\">Run in background</a><ul>\n<li><a class=\"reference internal\" href=\"#using-kegbot-master\">Using kegbot_master</a></li>\n<li><a class=\"reference internal\" href=\"#using-supervisor\">Using Supervisor</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "prev": {"link": "../install-pycore/", "title": "Install Pycore"}, "metatags": ""}